<!doctype html>
<html lang="en">
<head>
  <title>RDM with DataLad</title>
  <meta name="description" content=" Workshop on DataLad for research data management ">
  <meta name="author" content=" Adina Wagner & Lennart Wittkuhn ">

  <meta charset="utf-8">
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="../css/main.css" id="theme">
  <script src="../js/printpdf.js"></script>
</head>
<body>

<div class="reveal">
<div class="slides">

<section>
  <section>
      <h1>Reproducible Research</h1>
      <img height="500" src="../pics/Provenance_alpha.png">
      <imgcredit>CC-BY-SA Scriberia and The Turing Way</imgcredit>
  </section>


  <section  data-background-image="https://alchetron.com/cdn/jon-claerbout-c970ff70-1e60-4ccc-92ca-583bba1b56b-resize-750.jpeg",
  data-background-opacity="0.5">
      <q cite="Jon Claerbout (paraphrased)">
          An article about computational science in a scientific publication
          is not the scholarship itself, it is merely advertising of the scholarship.
          The actual scholarship is the complete software development environment
          and the complete set of instructions which generated the figures.
      </q>
      <br><small>
      Jon Claerbout (paraphrased)</small>
  </section>

  <section>
    <h2>Some definitions first...</h2>
      <img src="../pics/turingway/ReproducibleDefinitionGrid.png">
      <imgcredit>Illustration by Scriberia and The Turing Way</imgcredit>
      <br><small><a href="https://the-turing-way.netlify.app/reproducible-research/overview/overview-definitions.html#rr-overview-definitions" target="_blank">
      (The Turing Way)</a> </small>
  </section>

  <section data-transition="None">
    <h2>Common problems in science</h2>
          <div class="fragment fade-in" data-fragment-index="1">
              You write a paper about an algorithm, stay up
              late to generate good-looking figures, but you have to tweak parameters and
              display options to make it work AND look good. The next morning, you have no
              idea which parameters produced which figures, and which of the figures
              fits to what you report in the paper.<br>
          <img height="400" src="../pics/turingway/findfiles.png">
              <img height="400" src="../pics/turingway/projectstack.png"</div>
          <imgcredit>Illustration adapted from Scriberia and The Turing Way</imgcredit>
  </section>

  <section data-transition="None">
    <h2>Common problems in science</h2>
          <div class="fragment fade-in" data-fragment-index="1">
              Your research project produces phenomenal results, but your laptop,
              the only place that stores the source code for the results, is
              stolen/breaks<br>
          <img height="700" src="../pics/stolenlaptop.jpg"></div>
          <imgcredit>https://co.pinterest.com/pin/551128073121451139//imgcredit>
  </section>

  <section data-transition="None">
    <h2>Common problems in science</h2>
          <div class="fragment fade-in" data-fragment-index="1">
              A graduate student approaches his supervisor, complaining that the
              supervisors research idea does not work. After weeks of discussion,
              it becomes apparent that oral communication doesn't suffice - the
              student can't sufficiently explain the environment (data, algorithms,
              ...) they constructed, and if the supervisor can't enter and use the
              students project there's no way to find a fix.
              <br>
          <img height="500" src="../pics/badsupervision.gif"></div>
      <imgcredit>http://phdcomics.com/comics.php?f=1693</imgcredit>
  </section>

  <section data-transition="None">
    <h2>Common problems in science</h2>
          <div class="fragment fade-in" data-fragment-index="1">
              A Post-doc wrote a script during the PhD that applied a specific
              method to a dataset. Now, with new data and a new project, they
              try to reuse the script, but forgot how it worked.
              <br>
          <img height="500" src="../pics/frustration.jpg"></div>
      <imgcredit>http://phdcomics.com/comics.php?f=1693</imgcredit>
  </section>

  <section data-transition="None">
    <h2>common problems in science</h2>
          <div class="fragment fade-in" data-fragment-index="1">
              You try to recreate results from another lab's published paper.
              You base your re-implementation on everything reported in their paper,
              but the results you obtain look nowhere like the original.
              <br>
          <img height="500" src="../pics/turingway/ReadableCode.png"></div>
      <imgcredit>http://phdcomics.com/comics.php?f=1693</imgcredit>
  </section>

  <section>
    <h2><strike>common</strike> old problems in science</h2>
          <div class="fragment fade-in" data-fragment-index="1">
              All these problems were paraphrased from
              <a href="https://sci-hub.se/https://link.springer.com/chapter/10.1007%2F978-1-4612-2544-7_5" target="_blank">
                  Buckheit & Donoho, <b>1995</b></a>
              <br></div>
      <div class="fragment fade-in">Isn't it time to get better?</div>
      <div class="fragment fade-in">Both for you and your future self, as well as
          for science as a whole?</div>
      <div class="fragment fade-in">The tools exist, and are getting easier and
          easier to use. Sometimes, you only need to know that something exists
          to get started with it.</div>
  </section>


  <section>
      <h2>Reproducible Research</h2>
      <ul>
          <li class="fragment fade-in-then-semi-out">
              DataLad is one tool that can make reproducible research easier
          </li>
          <li class="fragment fade-in-then-semi-out">
              Let's take a more detailed look into some ways in which DataLad
              can help:
          </li>
      <ul class="fragment fade-in">
          <li>Details of the YODA principles for reproducible analyses</li>
          <li>DataLad as a component in reproducible papers</li>
          <li>The <code>datalad-container</code> extension to add and use software containers</li>
      </ul>
      </ul>
  </section>


<!--YODA principles-->

<section data-markdown><script type="text/template">
# Modularity

Need for meaningful units of data that are clearly recognizable for anyone. Only then we have a handle on the *what* in "what is important?"
<aside class="notes">
Note to self
</aside>
</script>
</section>

<section>
<h2>Easily lost modularity through obfuscation</h2>
Original
<pre><code class="sh" style="max-height:none" data-trim>
/dataset
├── sample1
│   └── a001.dat
├── sample2
│   └── a001.dat
...
</code></pre>
<div class="fragment">
After applied transform (preprocessing, analysis, ...)
<pre><code class="sh" style="max-height:none" data-trim>
/dataset
├── sample1
│   ├── ps34t.dat
│   └── a001.dat
├── sample2
│   ├── ps34t.dat
│   └── a001.dat
...
</code></pre>
Without expert/domain knowledge no distinction between original and derived data possible anymore.
</div>
</section>

<section>
<h2>Preserved modularity</h2>
Original
<pre><code class="sh" style="max-height:none" data-trim>
/raw_dataset
├── sample1
│   └── a001.dat
├── sample2
│   └── a001.dat
...
</code></pre>
<div class="fragment">
After applied transform (preprocessing, analysis, ...)
<pre><code class="sh" style="max-height:none" data-trim>
/derived_dataset
├── sample1
│   └── ps34t.dat
├── sample2
│   └── ps34t.dat
├── ...
└── inputs
    └── raw
        ├── sample1
        │   └── a001.dat
        ├── sample2
        │   └── a001.dat
        ...
</code></pre>
Clearer separation of semantics, through use of pristine version of original dataset within a
<em>new, additional</em> dataset holding the outputs.
</div>
</section>


<section>
<h2>DataLad: Dataset linkage</h2>
<img data-src="../pics/dataset_linkage.png">
<pre><code class="bash" style="font-size:115%;max-height:none">$ datalad clone --dataset . http://example.com/ds inputs/rawdata
</code></pre>

<pre><code class="diff" style="max-height:none">$ git diff HEAD~1
diff --git a/.gitmodules b/.gitmodules
new file mode 100644
index 0000000..c3370ba
--- /dev/null
+++ b/.gitmodules
@@ -0,0 +1,3 @@
+[submodule "inputs/rawdata"]
+       path = inputs/rawdata
+       url = http://example.com/importantds
diff --git a/inputs/rawdata b/inputs/rawdata
new file mode 160000
index 0000000..fabf852
--- /dev/null
+++ b/inputs/rawdata
@@ -0,0 +1 @@
+Subproject commit fabf8521130a13986bd6493cb33a70e580ce8572
</code></pre>
Each (sub)dataset is a separately, but jointly version-controlled entity.
    <aside class="notes">weighs just a few bytes</aside>
</section>

<section>
  <h2>Example modular data structure</h2>
  <img style="" height="750px" data-src="../pics/virtual_dirtree.png">
  <p style="margin-top:-.5em">Link precisely versioned inputs to version-controlled outputs</p>
    <aside class="notes">dataset linkage is pairwise, i.e. cheap</aside>
</section>

<section data-markdown><script type="text/template">
## When to modularize?

- Target audience is different
  - public vs. private
  - domain specific vs. domain general

- Pace of evolution is different
  - "factual" raw data vs. choices of (pre-)processing
  - completed acquisition vs. ongoing study

- Size impacts I/O and logistics
  - Git can struggle with 1M+ files
  - filesystems (licensing) can struggle with large numbers of inodes
  - More infos: [Go Big or Go Home chapter](http://handbook.datalad.org/en/latest/beyond_basics/basics-scaling.html)

- Legal/Access constraints
  - personal vs. anonymized data

<aside class="notes">
Note to self
</aside>
</script>
</section>
</section>

<!-- Reproducible paper -->
<section>
  <section>
      <h2>A PDF is not enough</h2>

      ... neither for others, nor for your future self. <br>
      What do we need apart from a PDF? <br>
      <ul>
          <li>code</li>
          <li>data</li>
          <li>software</li>
      </ul>
  </section>

  <section>
      <h2>Going beyond a PDF: A reproducible paper</h2>
      Let's take a look into a reproducible paper:
      <a href="https://github.com/psychoinformatics-de/paper-remodnav/" target="_blank">
          github.com/psychoinformatics-de/paper-remodnav/
      </a>
      <br>
      <br>
      <b>Disclaimer</b>
            <ul>
          <li>
              This is not the only way to create a reproducible paper
          </li>
          <li>
              This is certainly not the easiest way to do it
          </li>
          <li>
              But it is <i>one</i> way of connecting established tools into a functional
              solution
          </li>
          <li>
              You could redo this with the tools that you are familiar with
          </li>
          <li>
              A hands-on explanation and a demo of an alternative approach will follow
          </li>
      </ul>
  </section>


  <section>
    <h2>A reproducible paper sketch</h2>
      <ul>
          <li>We have created a template to recreate this analysis at
          <a href="https://github.com/datalad-handbook/repro-paper-sketch" target="_blank">
              github.com/datalad-handbook/repro-paper-sketch
          </a> </li>
          <li>
              Team up in break-out rooms, and follow the instructions in the README
              to make a paper, adjust the code, and re-make an updated paper (
              <a href="https://adswa.github.io/mpi-datamanagement-ws/content/reproduciblescience/#hands-on" target="_blank">
                  Hands-on 1 on the website</a>).
          </li>
      </ul>

  </section>



  <section>
      <h2>An alternative with RMarkdown</h2>
      demo by Lennart
  </section>

  <section>
  <h2>Summary: Reproducible Papers</h2>
      <ul>
          <li class="fragment fade-in"></li>
      </ul>
  </section>

  <section>

  </section>
</section>

<section>
    <h2>Why share software?</h2>
    <ul>
        <li>
            difficult or impossible to install (e.g. conflicts with existing software,
            or on HPC)
        </li>
        <li>
            different software versions/operating systems can produce different results
        </li>
    </ul>
</section>

  <section>
      <h2>Software containers</h2>
      <ul>
          <li class="fragment fade-in">
              Software containers encapsulate a software environment and isolate it from
              a surrounding operating system
          </li>
          <li class="fragment fade-in">
              Includes: Code, runtime, system tools, system libraries, settings <br>
              Does not include: Resource management
          </li>
          <li class="fragment fade-in">
              Put simple, a cut-down virtual machine that is a portable and shareable
              bundle of software libraries and their dependencies
          </li>
      </ul>
  </section>


  <section>
      <h2>Glossary</h2>
      <dl>
          <dt>recipe</dt>
          <dd>A text file template that lists all required components of the
              computational environment, e.g. a <i>Dockerfile</i> or <i>.def</i> file.
          </dd>
          <dt>image</dt>
          <dd>A static file system inside a file, populated with software specified in the recipe.
              "Describes everything we run"
          </dd>
          <dt>container</dt>
          <dd>A running instance of an Image</dd>
          <dt>Hub</dt>
          <dd>A storage resource to share and consume images, e.g.
              <a href="https://hub.docker.com/" target="_blank">Docker-Hub</a>  or
              <a href="https://singularity-hub.org/" target="_blank">Singularity-Hub</a>
          </dd>
      </dl>
  </section>

  <section>
      <h2>Docker versus Singularity</h2>
      <ul>
          <li>Main disadvantage of Docker: requires "sudo" (i.e., admin) privileges</li>
          <li>"Scientific alternative": Singularity </li>
          <ul>
              <li>built to run on computational clusters</li>
              <li>same user inside image than outside (no root)</li>
              <li>easier to access GPUs and run graphical applications</li>
          </ul>
          <li>Singularity can use and build Docker Images</li>
          <li>DataLad can register Docker and Singularity Images to a dataset</li>
      </ul>
  </section>

  <section>
      <h2>The datalad-container extension</h2>
      <pre><code>pip install datalad-container</code></pre>
  </section>

  <section>
      <h2>Adding software to datasets</h2>
      <li>Can be added from a local path or a URL</li>
      <li>Advice: Put your image on a Hub, and register it from a public URL</li>

  </section>

  <section>
      <h2>Adding a Singularity Image</h2>
      from a path:

      from a URL:
            <li>Singularity Images are a single file</li>
  </section>

  <section>
      <h2>Adding a Docker Image</h2>
      from a path:

      from a URL:
      <li></li>
  </section>

  <section>
    <h2>Software containers</h2>
      <ul>
          Helpful resources for working with software containers:
          <li>
              <a href="https://github.com/jupyterhub/repo2docker" target="_blank">
                  repo2docker</a> can fetch a Git repository/DataLad dataset and builds
              a container image from configuration files
          </li>
          <li>
              <a href="https://github.com/ReproNim/neurodocker" target="_blank">
                  neurodocker</a> can generate custom Dockerfiles and Singularity recipes
              for neuroimaging.
              </a>
          </li>
          <li>
              <a href="https://github.com/repronim/containers" target="_blank">
                  The ReproNim container collection</a>, a DataLad dataset that
              includes common neuroimaging software as configured singularity containers.
          </li>
      </ul>
  </section>

  <section>
      <h2>Summary</h2>
      Where can DataLad help?
      <table>
          <tr>
              <td>
                <img src="../pics/turingway/ReproducibleDefinitionGrid.png">
                <imgcredit>Illustration by Scriberia and The Turing Way</imgcredit>
              </td>
              <td>
                  <table>
                      <tr>
                         <b>Reproducible</b><br>
                          automatic recompute <br>
                          and identity checks<br>
                          <b>Replicable</b><br>
                          Easily exchange <br>
                          input data<br>
                          <b>Robust</b><br>
                          Reuse data & change<br>
                          code, update paper <br>
                          <b>Generalisable</b><br>
                          Share analysis in an<br>
                          easily reusable and<br>
                          adaptable framework
                      </tr>
                  </table>

              </td>
          </tr>
      </table>

  </section>
  </section>

</div> <!-- /.slides -->
</div> <!-- /.reveal -->

<script src="../reveal.js/js/reveal.js"></script>

<script>
  // Full list of configuration options available at:
  // https://github.com/hakimel/reveal.js#configuration
  Reveal.initialize({
    // The "normal" size of the presentation, aspect ratio will be preserved
    // when the presentation is scaled to fit different resolutions. Can be
    // specified using percentage units.
    width: 1280,
    height: 960,

    // Factor of the display size that should remain empty around the content
    margin: 0.1,

    // Bounds for smallest/largest possible scale to apply to content
    minScale: 0.2,
    maxScale: 1.0,

    controls: true,
    progress: true,
    history: true,
    center: true,

    transition: 'slide', // none/fade/slide/convex/concave/zoom

    // Optional reveal.js plugins
    dependencies: [
      { src: '../reveal.js/plugin/highlight/highlight.js', async: true, condition: function() { return !!document.querySelector( 'pre code' ); }, callback: function() { hljs.initHighlightingOnLoad(); } },
      { src: '../reveal.js/plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
      { src: '../reveal.js/plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
      { src: '../reveal.js/plugin/zoom-js/zoom.js', async: true },
      { src: '../reveal.js/plugin/notes/notes.js', async: true }
    ]
  });
</script>
</body>
</html>
